{
  "hash": "d472df8a0447ba263c49c55a397c2236",
  "result": {
    "markdown": "---\ntitle: \"Difference between R and SAS in estimating median survival time\"\nauthor: \"Zhanwen Peng\"\ndate: \"2025-01-03\"\ncategories: [R, SAS, survival]\ncode-block-border-left: true\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(SASmarkdown)\nlibrary(tidyverse)\nlibrary(survival)\nlibrary(survminer)\n```\n:::\n\n\nIn this post we are going to discuss about the difference between R and SAS in estimating median survival time.\n\nFirstly, Create a simple survival dataset in tibble form.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurv_data <- tribble(\n  ~AVAL, ~CNSR,\n  1,   0,\n  4,   0,\n  7,   1,\n  8,   1,\n)\nsurv_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 Ã— 2\n   AVAL  CNSR\n  <dbl> <dbl>\n1     1     0\n2     4     0\n3     7     1\n4     8     1\n```\n:::\n:::\n\n\nUsing `survival` package in `r` to estimate the median survival time and plot the KM graph.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkm_model <- survfit(Surv(AVAL, CNSR==0) ~ 1, data = surv_data,conf.type=c(\"log-log\"))\nggsurvplot(km_model, data = surv_data, risk.table = FALSE, conf.int = F,\n           title = \"Dummy survival data\", \n           submain = \"Kaplan-Meier estimates\", \n           break.x.by = 1,\n           ylab = \"Survival\",\n           xlab = \"AVAL\",\n           legend.title = \"\",surv.median.line = \"hv\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nwe can see that in $t=4$, the KM graph coincides with line $y=0.5$, then we estimate the median survival time in `r`,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquantile(km_model,0.5)$quantile\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n50 \n 6 \n```\n:::\n:::\n\n\nAccording the result above, the estimated median is $6$.\n\nWhat if we use the same dataset but estimate survival median using `proc lifetest` in `SAS` instead.\n\n::: {.cell}\n\n```{.sas .cell-code}\noption locale='en_us';\ndata surv_data;\n\tinput AVAL CNSR;\n\tcards;\n\t1 0\n\t4 0\n\t6 1\n\t8 1\n\t;\nrun;\n\nods exclude all;\nods output productlimitestimates=est Quartiles=ql;\nproc lifetest data=surv_data method=km reduceout outsurv=plc ;\n    time AVAL*CNSR(1);\nrun;\nods exclude close;\n\nproc print data=ql;\nrun;\n```\n\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                         Lower       Upper\nObs    STRATUM    Percent    Estimate    Transform       Limit       Limit\n\n 1        1           75       .          LOGLOG       1.00000      .     \n 2        1           50       .          LOGLOG       1.00000      .     \n 3        1           25      2.50000     LOGLOG       1.00000      .     \n```\n:::\n:::\n\nWe can see that the estimation of median is actually `NA`, this means that `R` and `SAS` are using different formula to estimate the median.\n\nIn short, `survival` package in `R` and early version of `SAS` (such as 9.1) estimate the quantiles using:\n$$\n\\begin{aligned}\nq_p &= \\frac{1}{2}(\\inf_t\\{1-\\hat{S}(t)\\ge p\\}+\\sup_t\\{1-\\hat{S}(t)\\le q\\})\\\\\n&=\\frac{1}{2}(\\inf_t\\{\\hat{S}(t)\\le 1-p\\}+\\sup_t\\{\\hat{S}(t)\\ge 1-q\\})\\\n\\end{aligned}\n$$\nTherefore the result from `survival` is $\\frac{1}{2}(4+8)=6$.\n\nIn `SAS 9.4`, the formula is\n$$\nq_p = \\min\\{t_j|\\hat{S}(t_j)<1-p\\}\n$$\nSince there is no data point such that $\\hat{S}(t_j)$ is strictly less then $0.5$, the estimation of median from `SAS` is `NA`.\n\n### References\n[proc lifetest](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.4/statug/statug_lifetest_details03.htm)\\\n\n[survival: Survival Analysis](https://cran.r-project.org/web/packages/survival/survival.pdf)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}